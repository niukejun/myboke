---
title: 04 æŒä¹…åŒ–æ•°æ®åº“ - å…¥é—¨
date: 2025-4-27
updated: 2025-4-27
categories: è®¡ç®—æœº
tags:
  - docker
  - å­¦ä¹ 
---

## ğŸ’¾ æŒä¹…åŒ–æˆ‘ä»¬çš„æ•°æ®åº“

ä½ å¯èƒ½æ²¡æ³¨æ„åˆ°ï¼Œæ¯æ¬¡å¯åŠ¨å®¹å™¨æ—¶ï¼Œæˆ‘ä»¬çš„å¾…åŠäº‹é¡¹åˆ—è¡¨éƒ½ä¼šè¢«æ¸…ç©ºã€‚è¿™æ˜¯ä¸ºä»€ä¹ˆå‘¢ï¼Ÿè®©æˆ‘ä»¬æ·±å…¥äº†è§£ä¸€ä¸‹å®¹å™¨çš„å·¥ä½œåŸç†ã€‚

## ğŸ“ å®¹å™¨çš„æ–‡ä»¶ç³»ç»Ÿ

å®¹å™¨è¿è¡Œæ—¶ï¼Œä¼šä½¿ç”¨é•œåƒä¸­çš„å„ä¸ªå±‚ä½œä¸ºå…¶æ–‡ä»¶ç³»ç»Ÿã€‚æ¯ä¸ªå®¹å™¨è¿˜ä¼šè·å¾—è‡ªå·±çš„â€œæš‚å­˜ç©ºé—´â€æ¥åˆ›å»º/æ›´æ–°/åˆ é™¤æ–‡ä»¶ã€‚ä»»ä½•æ›´æ”¹éƒ½ä¸ä¼šåœ¨å…¶ä»–å®¹å™¨ä¸­æ˜¾ç¤ºï¼Œ *å³ä½¿* å®ƒä»¬ä½¿ç”¨ç›¸åŒçš„é•œåƒã€‚

### ğŸ§ª å®è·µè¯æ˜

ä¸ºäº†æ¼”ç¤ºæ­¤æ“ä½œï¼Œæˆ‘ä»¬å°†å¯åŠ¨ä¸¤ä¸ªå®¹å™¨ï¼Œå¹¶åœ¨æ¯ä¸ªå®¹å™¨ä¸­åˆ›å»ºä¸€ä¸ªæ–‡ä»¶ã€‚æ‚¨å°†çœ‹åˆ°ï¼Œåœ¨ä¸€ä¸ªå®¹å™¨ä¸­åˆ›å»ºçš„æ–‡ä»¶åœ¨å¦ä¸€ä¸ªå®¹å™¨ä¸­ä¸å¯ç”¨ã€‚

1. å¯åŠ¨ä¸€ä¸ª `ubuntu` å®¹å™¨ï¼Œå®ƒå°†åˆ›å»ºä¸€ä¸ª `/data.txt` ä»¥ 1 åˆ° 10000 ä¹‹é—´çš„éšæœºæ•°å‘½åçš„æ–‡ä»¶ã€‚
	```js
	docker run -d ubuntu bash -c "shuf -i 1-10000 -n 1 -o /data.txt && tail -f /dev/null"
	```
	å¦‚æœä½ å¯¹è¿™ä¸ªå‘½ä»¤æ„Ÿå…´è¶£ï¼Œæˆ‘ä»¬å¯åŠ¨ä¸€ä¸ª bash shell å¹¶è°ƒç”¨ä¸¤ä¸ªå‘½ä»¤ï¼ˆè¿™å°±æ˜¯ä¸ºä»€ä¹ˆæˆ‘ä»¬æœ‰ `&&` ï¼‰ã€‚ç¬¬ä¸€éƒ¨åˆ†é€‰æ‹©ä¸€ä¸ªéšæœºæ•°å¹¶å°†å…¶å†™å…¥ `/data.txt` ã€‚ç¬¬äºŒæ¡å‘½ä»¤åªæ˜¯ç›‘è§†ä¸€ä¸ªæ–‡ä»¶ä»¥ä¿æŒå®¹å™¨è¿è¡Œã€‚
2. éªŒè¯æˆ‘ä»¬æ˜¯å¦å¯ä»¥é€šè¿‡è¿›å…¥å®¹å™¨æ¥æŸ¥çœ‹è¾“å‡º `exec` ã€‚ä¸ºæ­¤ï¼Œè¯·æ‰“å¼€ä»ªè¡¨æ¿ï¼Œæ‰¾åˆ°æ‚¨çš„ Ubuntu å®¹å™¨ï¼Œç‚¹å‡»â€œä¸‰ç‚¹â€èœå•ä»¥è·å–å…¶ä»–æ“ä½œï¼Œç„¶åç‚¹å‡»â€œåœ¨ç»ˆç«¯ä¸­æ‰“å¼€â€èœå•é¡¹ã€‚
	![ä»ªè¡¨æ¿æ‰“å¼€ CLI è¿›å…¥ ubuntu å®¹å™¨](http://localhost/tutorial/persisting-our-data/dashboard-open-cli-ubuntu.png)
	æ‚¨å°†çœ‹åˆ°ä¸€ä¸ªåœ¨ ubuntu å®¹å™¨ä¸­è¿è¡Œ shell çš„ç»ˆç«¯ã€‚è¿è¡Œä»¥ä¸‹å‘½ä»¤æŸ¥çœ‹æ–‡ä»¶å†…å®¹ `/data.txt` ã€‚ä¹‹åå†æ¬¡å…³é—­æ­¤ç»ˆç«¯ã€‚
	```js
	cat /data.txt
	```
	å¦‚æœæ‚¨æ›´å–œæ¬¢å‘½ä»¤è¡Œï¼Œä¹Ÿå¯ä»¥ä½¿ç”¨ä»¥ä¸‹ `docker exec` å‘½ä»¤æ‰§è¡Œç›¸åŒæ“ä½œã€‚æ‚¨éœ€è¦è·å–å®¹å™¨çš„ IDï¼ˆä½¿ç”¨ `docker ps` è·å–ï¼‰å¹¶ä½¿ç”¨ä»¥ä¸‹å‘½ä»¤è·å–å†…å®¹ã€‚
	```js
	docker exec <container-id> cat /data.txt
	```
	æ‚¨åº”è¯¥ä¼šçœ‹åˆ°ä¸€ä¸ªéšæœºæ•°ï¼
3. ç°åœ¨ï¼Œè®©æˆ‘ä»¬å¯åŠ¨å¦ä¸€ä¸ª `ubuntu` å®¹å™¨ï¼ˆç›¸åŒçš„å›¾åƒï¼‰ï¼Œæˆ‘ä»¬å°†çœ‹åˆ°æˆ‘ä»¬æ²¡æœ‰ç›¸åŒçš„æ–‡ä»¶ã€‚
	```js
	docker run -it ubuntu ls /
	```
	ç§ï¼é‚£é‡Œæ²¡æœ‰ `data.txt` æ–‡ä»¶ï¼é‚£æ˜¯å› ä¸ºå®ƒåªè¢«å†™å…¥äº†ç¬¬ä¸€ä¸ªå®¹å™¨çš„æš‚å­˜ç©ºé—´ã€‚
4. ç»§ç»­ä½¿ç”¨ `docker rm -f <container-id>` å‘½ä»¤åˆ é™¤ç¬¬ä¸€ä¸ªå®¹å™¨ã€‚
	```js
	docker rm -f <container-id>
	```

## ğŸ“¦ å®¹å™¨ä½“ç§¯

åœ¨ä¹‹å‰çš„å®éªŒä¸­ï¼Œæˆ‘ä»¬çœ‹åˆ°æ¯ä¸ªå®¹å™¨æ¯æ¬¡å¯åŠ¨æ—¶éƒ½ä¼šä»é•œåƒå®šä¹‰å¼€å§‹ã€‚è™½ç„¶å®¹å™¨å¯ä»¥åˆ›å»ºã€æ›´æ–°å’Œåˆ é™¤æ–‡ä»¶ï¼Œä½†å½“å®¹å™¨è¢«ç§»é™¤æ—¶ï¼Œè¿™äº›æ›´æ”¹ä¼šä¸¢å¤±ï¼Œå¹¶ä¸”æ‰€æœ‰æ›´æ”¹éƒ½ä¼šè¢«éš”ç¦»åˆ°è¯¥å®¹å™¨å†…ã€‚ä½¿ç”¨å·ï¼Œæˆ‘ä»¬å¯ä»¥æ”¹å˜è¿™ä¸€åˆ‡ã€‚

[Volumes](https://docs.docker.com/storage/volumes/) provide the ability to connect specific filesystem paths of the container back to the host machine. If a directory in the container is mounted, changes in that directory are also seen on the host machine. If we mount that same directory across container restarts, we'd see the same files.

There are two main types of volumes. We will eventually use both, but we will start with **named volumes**.

## ğŸ’¾ Persisting our Todo Data

By default, the todo app stores its data in a [SQLite Database](https://www.sqlite.org/index.html) at `/etc/todos/todo.db`. If you're not familiar with SQLite, no worries! It's simply a relational database in which all of the data is stored in a single file. While this isn't the best for large-scale applications, it works for small demos. We'll talk about switching this to a different database engine later.

With the database being a single file, if we can persist that file on the host and make it available to the next container, it should be able to pick up where the last one left off. By creating a volume and attaching (often called "mounting") it to the directory the data is stored in, we can persist the data. As our container writes to the `todo.db` file, it will be persisted to the host in the volume.

As mentioned, we are going to use a **named volume**. Think of a named volume as simply a bucket of data. Docker maintains the physical location on the disk and you only need to remember the name of the volume. Every time you use the volume, Docker will make sure the correct data is provided.

1. Create a volume by using the `docker volume create` command.
	```js
	docker volume create todo-db
	```
2. Stop the todo app container once again in the Dashboard (or with `docker rm -f <container-id>`), as it is still running without using the persistent volume.
3. Start the todo app container, but add the `-v` flag to specify a volume mount. We will use the named volume and mount it to `/etc/todos`, which will capture all files created at the path.
	```js
	docker run -dp 3000:3000 -v todo-db:/etc/todos getting-started
	```
4. Once the container starts up, open the app and add a few items to your todo list.
	![å·²æ·»åŠ åˆ°å¾…åŠäº‹é¡¹åˆ—è¡¨çš„é¡¹ç›®](http://localhost/tutorial/persisting-our-data/items-added.png)
5. Remove the container for the todo app. Use the Dashboard or `docker ps` to get the ID and then `docker rm -f <container-id>` to remove it.
6. Start a new container using the same command from above.
7. Open the app. You should see your items still in your list!
8. Go ahead and remove the container when you're done checking out your list.

Hooray! You've now learned how to persist data!

Pro-tip

While named volumes and bind mounts (which we'll talk about in a minute) are the two main types of volumes supported by a default Docker engine installation, there are many volume driver plugins available to support NFS, SFTP, NetApp, and more! This will be especially important once you start running containers on multiple hosts in a clustered environment with Swarm, Kubernetes, etc.

## Diving into our Volume

å¾ˆå¤šäººç»å¸¸é—®â€œ å½“æˆ‘ä½¿ç”¨å‘½åå·æ—¶ï¼Œ Docker *å®é™…ä¸Š* `docker volume inspect` å°†æˆ‘çš„æ•°æ®å­˜å‚¨åœ¨å“ªé‡Œï¼Ÿâ€å¦‚æœæ‚¨æƒ³çŸ¥é“ï¼Œå¯ä»¥ä½¿ç”¨è¯¥å‘½ä»¤ã€‚

```js
docker volume inspect todo-db
[
    {
        "CreatedAt": "2019-09-26T02:18:36Z",
        "Driver": "local",
        "Labels": {},
        "Mountpoint": "/var/lib/docker/volumes/todo-db/_data",
        "Name": "todo-db",
        "Options": {},
        "Scope": "local"
    }
]
```

è¿™ `Mountpoint` æ˜¯ç£ç›˜ä¸Šå­˜å‚¨æ•°æ®çš„å®é™…ä½ç½®ã€‚è¯·æ³¨æ„ï¼Œåœ¨å¤§å¤šæ•°æœºå™¨ä¸Šï¼Œæ‚¨éœ€è¦æ‹¥æœ‰ root æƒé™æ‰èƒ½ä»ä¸»æœºè®¿é—®æ­¤ç›®å½•ã€‚ä½†æ˜¯ï¼Œå®ƒç¡®å®å°±åœ¨é‚£é‡Œï¼

## å›é¡¾

è‡³æ­¤ï¼Œæˆ‘ä»¬ç»ˆäºæœ‰äº†ä¸€ä¸ªå¯ä»¥æ­£å¸¸è¿è¡Œä¸”é‡å¯åä¾ç„¶èƒ½æ­£å¸¸å·¥ä½œçš„åº”ç”¨ç¨‹åºï¼æˆ‘ä»¬å¯ä»¥å‘æŠ•èµ„è€…å±•ç¤ºå®ƒï¼Œå¸Œæœ›ä»–ä»¬èƒ½å¤Ÿç†è§£æˆ‘ä»¬çš„æ„¿æ™¯ï¼

ç„¶è€Œï¼Œæˆ‘ä»¬ä¹‹å‰çœ‹åˆ°ï¼Œæ¯æ¬¡ä¿®æ”¹éƒ½é‡å»ºé•œåƒä¼šè€—è´¹ç›¸å½“å¤šçš„æ—¶é—´ã€‚è‚¯å®šæœ‰æ›´å¥½çš„æ–¹æ³•æ¥è¿›è¡Œä¿®æ”¹ï¼Œå¯¹å§ï¼Ÿæœ‰äº†ç»‘å®šæŒ‚è½½ï¼ˆæˆ‘ä»¬ä¹‹å‰æåˆ°è¿‡ï¼‰ï¼Œå°±æœ‰æ›´å¥½çš„æ–¹æ³•ï¼ç°åœ¨å°±è®©æˆ‘ä»¬æ¥çœ‹çœ‹ï¼
